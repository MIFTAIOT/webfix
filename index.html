<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>e-Learning English by Mam Yanti</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* =========================================
           1. GLOBAL VARIABLES & RESET
           ========================================= */
        :root {
            /* Brand Colors */
            --primary: #4A90E2; 
            --primary-dark: #357ABD;
            --secondary: #50E3C2;
            --accent: #FF6B6B;
            
            /* WhatsApp Colors */
            --wa-bg: #E5DDD5;
            --wa-header: #008069;
            --wa-chat-me: #D9FDD3;
            --wa-chat-other: #FFFFFF;

            /* UI Colors */
            --bg-body: #F0F2F5;
            --card-bg: #FFFFFF;
            --text-main: #333333;
            --text-muted: #777777;
            --border: #E0E0E0;
            --shadow: 0 4px 12px rgba(0,0,0,0.05);
            --radius: 16px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden; /* Prevent body scroll */
        }

        /* Helper Classes */
        .hidden { display: none !important; }
        .flex-center { display: flex; justify-content: center; align-items: center; }
        .btn { cursor: pointer; border: none; font-family: inherit; transition: 0.2s; }
        
        /* Spinner */
        .spinner-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .spinner { width: 40px; height: 40px; border: 4px solid #eee; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* =========================================
           2. LOGIN PAGE (Shared)
           ========================================= */
        #login-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #4A90E2 0%, #50E3C2 100%);
            z-index: 9999;
            flex-direction: column;
        }
        .login-card {
            background: white; padding: 40px; border-radius: 24px;
            width: 90%; max-width: 400px; text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }
        .login-btn {
            background: white; border: 1px solid #ddd; padding: 12px;
            border-radius: 50px; width: 100%; display: flex;
            align-items: center; justify-content: center; gap: 10px;
            font-weight: 600; margin-top: 20px; cursor: pointer;
        }
        .login-btn:hover { background: #f9f9f9; }

        /* =========================================
           3. TEACHER DASHBOARD (LAPTOP / LANDSCAPE)
           ========================================= */
        #teacher-app {
            width: 100%; height: 100vh;
            display: grid;
            grid-template-columns: 260px 1fr; /* Sidebar fixed, Content fluid */
            background-color: #F5F7FA;
        }

        /* Sidebar Guru */
        .teacher-sidebar {
            background: white; border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 20px;
        }
        .sidebar-header { margin-bottom: 40px; display: flex; align-items: center; gap: 10px; color: var(--primary); }
        .sidebar-menu { list-style: none; flex-grow: 1; }
        .sidebar-menu li { margin-bottom: 10px; }
        .sidebar-btn {
            width: 100%; text-align: left; padding: 12px 15px;
            background: transparent; border-radius: 10px;
            color: var(--text-muted); font-weight: 500; display: flex; align-items: center; gap: 12px;
            cursor: pointer;
        }
        .sidebar-btn:hover, .sidebar-btn.active {
            background-color: #E3F2FD; color: var(--primary);
        }
        .sidebar-btn i { width: 20px; text-align: center; }
        
        /* Content Guru */
        .teacher-content {
            padding: 30px; overflow-y: auto; position: relative;
        }
        .teacher-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;
        }
        .action-card-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;
        }
        .t-card {
            background: white; padding: 20px; border-radius: 16px;
            border: 1px solid var(--border); box-shadow: var(--shadow);
            transition: transform 0.2s; cursor: pointer;
        }
        .t-card:hover { transform: translateY(-3px); border-color: var(--primary); }
        .t-card h3 { font-size: 1.1em; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        
        /* Table Styling */
        .data-table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; }
        .data-table th, .data-table td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        .data-table th { background-color: #F8F9FA; font-weight: 600; color: #555; }
        
        /* Tombol Khusus Guru */
        .btn-primary-lg {
            background: var(--primary); color: white; padding: 12px 24px;
            border-radius: 8px; font-weight: 600; display: inline-flex; align-items: center; gap: 8px;
        }
        .btn-danger-lg {
            background: var(--accent); color: white; padding: 12px 24px;
            border-radius: 8px; font-weight: 600;
        }

        /* =========================================
           4. STUDENT UI (MOBILE APP / PORTRAIT)
           ========================================= */
        #student-app {
            width: 100%; height: 100%;
            flex-direction: column;
            background-color: #FAFAFA;
            max-width: 480px; margin: 0 auto; /* Limit width on desktop */
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
            position: relative;
        }

        /* Top Bar Siswa */
        .mobile-header {
            padding: 20px; background: white; 
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }
        .student-points {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: white; padding: 5px 12px; border-radius: 20px;
            font-weight: 700; font-size: 0.9em; display: flex; align-items: center; gap: 5px;
            box-shadow: 0 2px 5px rgba(255, 165, 0, 0.3);
        }

        /* Content Area Siswa */
        .mobile-content {
            flex-grow: 1; overflow-y: auto; padding: 20px; padding-bottom: 90px; /* Space for bottom nav */
        }
        .mobile-page { display: none; animation: fadeIn 0.3s ease; }
        .mobile-page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Cards Mobile */
        .m-card {
            background: white; padding: 15px; border-radius: 16px;
            margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.03);
            position: relative; overflow: hidden;
        }
        .m-card.highlight { background: linear-gradient(135deg, var(--primary) 0%, #64B5F6 100%); color: white; }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: absolute; bottom: 0; width: 100%;
            background: white; padding: 10px 20px;
            display: flex; justify-content: space-around; align-items: center;
            border-top: 1px solid #eee; border-top-left-radius: 20px; border-top-right-radius: 20px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center;
            color: #BBB; font-size: 0.75em; gap: 4px; background: none; cursor: pointer;
        }
        .nav-item i { font-size: 1.4em; margin-bottom: 2px; transition: 0.2s; }
        .nav-item.active { color: var(--primary); font-weight: 600; }
        .nav-item.active i { transform: translateY(-3px); }

        /* =========================================
           5. WHATSAPP CLONE UI (Student Chat)
           ========================================= */
        .wa-container {
            display: flex; flex-direction: column; height: calc(100vh - 140px);
            background-color: var(--wa-bg);
            /* Background Pattern WA */
            background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');
            background-size: 400px;
        }
        .wa-header {
            background-color: var(--wa-header); color: white; padding: 10px 15px;
            display: flex; align-items: center; gap: 10px;
        }
        .wa-messages { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 8px; }
        .wa-bubble {
            max-width: 80%; padding: 8px 12px; border-radius: 8px; position: relative;
            font-size: 0.9em; line-height: 1.4; box-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }
        .wa-bubble.me {
            align-self: flex-end; background-color: var(--wa-chat-me);
            border-top-right-radius: 0;
        }
        .wa-bubble.you {
            align-self: flex-start; background-color: var(--wa-chat-other);
            border-top-left-radius: 0;
        }
        .wa-time { font-size: 0.7em; color: #999; float: right; margin-left: 10px; margin-top: 4px; }
        .wa-input-area {
            padding: 8px; background: #F0F0F0; display: flex; align-items: center; gap: 8px;
        }
        .wa-input {
            flex-grow: 1; border: none; padding: 10px 15px; border-radius: 20px; background: white;
        }
        .wa-send-btn {
            background: var(--wa-header); color: white; width: 40px; height: 40px;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
        }

        /* =========================================
           6. LEADERBOARD TABS
           ========================================= */
        .lb-tabs { display: flex; gap: 10px; margin-bottom: 15px; background: #EEE; padding: 5px; border-radius: 10px; }
        .lb-tab { flex: 1; padding: 8px; border-radius: 8px; border: none; background: none; font-weight: 500; color: #777; cursor: pointer; }
        .lb-tab.active { background: white; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        .rank-item {
            display: flex; align-items: center; padding: 12px; border-bottom: 1px solid #f0f0f0;
        }
        .rank-num { width: 30px; font-weight: 700; color: var(--primary); font-size: 1.2em; text-align: center; }
        .rank-info { flex-grow: 1; margin-left: 10px; }
        .rank-name { font-weight: 600; font-size: 0.95em; }
        .rank-class { font-size: 0.75em; color: #999; }
        .rank-pts { font-weight: 700; color: #FFAA00; }

        /* Footer Style */
        .miapps-footer {
            text-align: center; padding: 20px; font-size: 0.75em; color: #aaa; margin-top: auto;
        }
    </style>
</head>
<body>

    <div id="login-page" class="flex-center">
        <div class="login-card">
            <h1 style="color: var(--primary); margin-bottom: 5px;">e-Learning</h1>
            <h2 style="font-weight: 400; margin-bottom: 30px; color: #666;">English by Mam Yanti</h2>
            <p style="font-size: 0.9em; color: #888; margin-bottom: 20px;">Masuk untuk mulai belajar seru!</p>
            
            <button id="login-btn" class="login-btn">
                <img src="https://developers.google.com/identity/images/g-logo.png" alt="G" width="20">
                Masuk dengan Google
            </button>
            
            <div id="login-spinner" class="hidden" style="margin-top: 20px;">
                 <div class="spinner" style="margin: 0 auto;"></div>
                 <p style="margin-top: 10px; font-size: 0.8em; color: #888;">Menghubungkan ke Google...</p>
            </div>
        </div>
        <div class="miapps-footer" style="color: white;">Web ini dibuat oleh MiAppsDeveloper 2025</div>
    </div>

    <div id="teacher-app" class="hidden">
        <nav class="teacher-sidebar">
            <div class="sidebar-header">
                <i class="fa-solid fa-graduation-cap fa-xl"></i>
                <h3 style="font-size: 1.2em;">Mam Yanti</h3>
            </div>
            <ul class="sidebar-menu">
                <li><button class="sidebar-btn active" onclick="switchTeacherTab('t-dashboard')"><i class="fa-solid fa-house"></i> Dashboard</button></li>
                <li><button class="sidebar-btn" onclick="switchTeacherTab('t-class')"><i class="fa-solid fa-users"></i> Data Kelas</button></li>
                <li><button class="sidebar-btn" onclick="switchTeacherTab('t-bank')"><i class="fa-solid fa-box-archive"></i> Bank Soal</button></li>
                <li><button class="sidebar-btn" onclick="switchTeacherTab('t-rank')"><i class="fa-solid fa-trophy"></i> Leaderboard</button></li>
                <li><button class="sidebar-btn" onclick="switchTeacherTab('t-feedback')"><i class="fa-solid fa-comment-dots"></i> Feedback Siswa</button></li>
            </ul>
            <button class="sidebar-btn" id="teacher-logout" style="color: var(--accent);"><i class="fa-solid fa-right-from-bracket"></i> Keluar</button>
        </nav>

        <main class="teacher-content">
            <div id="t-dashboard" class="teacher-tab">
                <div class="teacher-header">
                    <div>
                        <h1 style="font-size: 1.8em;">Selamat Datang, Mam!</h1>
                        <p style="color: #777;">Siap mengajar hari ini?</p>
                    </div>
                    <div style="display: flex; gap: 10px;">
                         <button class="btn-primary-lg" id="manual-point-btn" onclick="alert('Fitur Tambah Poin Manual akan muncul disini')"><i class="fa-solid fa-star"></i> Beri Poin Manual</button>
                         <button class="btn-danger-lg" id="end-class-btn" onclick="alert('Pop-up Feedback akan muncul di HP siswa')"><i class="fa-solid fa-bell"></i> Akhiri Kelas & Minta Feedback</button>
                    </div>
                </div>

                <h3 style="margin-bottom: 15px;">Aksi Cepat</h3>
                <div class="action-card-grid">
                    <div class="t-card btn" onclick="alert('Fitur Game akan segera hadir!')">
                        <h3 style="color: #9B59B6;"><i class="fa-solid fa-gamepad"></i> Mulai Game</h3>
                        <p style="font-size: 0.9em; color: #666;">Ice breaking & pembagian kelompok otomatis.</p>
                    </div>
                    <div class="t-card btn" onclick="switchTeacherTab('t-bank')">
                        <h3 style="color: var(--primary);"><i class="fa-solid fa-play"></i> Mulai Kuis</h3>
                        <p style="font-size: 0.9em; color: #666;">Ambil soal dari bank soal dan mainkan.</p>
                    </div>
                </div>
            </div>

            <div id="t-rank" class="teacher-tab hidden">
                <h2 style="margin-bottom: 20px;">Papan Peringkat Siswa</h2>
                <div class="lb-tabs">
                    <button class="lb-tab active" onclick="toggleRankTab('class')">Per Kelas</button>
                    <button class="lb-tab" onclick="toggleRankTab('global')">Global (Semua)</button>
                </div>
                <div class="t-card">
                    <table class="data-table" id="teacher-rank-table">
                        <thead>
                            <tr><th>#</th><th>Nama Siswa</th><th>Kelas</th><th>Total Poin</th><th>Aksi</th></tr>
                        </thead>
                        <tbody>
                            <tr><td colspan="5" style="text-align: center; padding: 30px;">
                                <div style="color: #ccc;">Data Leaderboard Real-time akan muncul disini</div>
                            </td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="t-class" class="teacher-tab hidden"><h2>Manajemen Kelas</h2><p>List kelas akan muncul disini.</p></div>
            <div id="t-bank" class="teacher-tab hidden"><h2>Bank Soal</h2><p>Manajemen kuis disini.</p></div>
            <div id="t-feedback" class="teacher-tab hidden"><h2>Feedback & Saran</h2><p>Hasil saran siswa muncul disini.</p></div>

            <div class="miapps-footer">Web ini dibuat oleh MiAppsDeveloper 2025</div>
        </main>
    </div>

    <div id="student-app" class="hidden">
        
        <div class="mobile-header">
            <div>
                <h2 style="font-size: 1.2em; color: var(--primary);">Hi, <span id="s-name-display">Student</span>!</h2>
                <p style="font-size: 0.8em; color: #999;" id="s-class-display">XII-1</p>
            </div>
            <div class="student-points">
                <i class="fa-solid fa-star"></i> <span id="s-points-display">0</span> Pts
            </div>
        </div>

        <div class="mobile-content">
            
            <div id="s-home" class="mobile-page active">
                <div class="m-card highlight">
                    <h3 style="font-size: 1.1em; margin-bottom: 5px;">Sudah Absen?</h3>
                    <p style="font-size: 0.9em; opacity: 0.9; margin-bottom: 10px;">Jangan lupa absen sebelum pelajaran mulai.</p>
                    <button class="btn" style="background: white; color: var(--primary); padding: 8px 15px; border-radius: 20px; font-weight: 600; font-size: 0.85em;" onclick="alert('Fitur Absen akan dibuka')">Isi Absensi</button>
                </div>

                <h3 style="font-size: 1em; margin: 20px 0 10px 0; color: #555;">Menu Belajar</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="m-card btn" style="text-align: center;" onclick="alert('Masuk ke lobi kuis...')">
                        <i class="fa-solid fa-rocket fa-2x" style="color: #FF6B6B; margin-bottom: 10px;"></i>
                        <div style="font-weight: 600; font-size: 0.9em;">Live Quiz</div>
                    </div>
                    <div class="m-card btn" style="text-align: center;">
                        <i class="fa-solid fa-book-open fa-2x" style="color: #4A90E2; margin-bottom: 10px;"></i>
                        <div style="font-weight: 600; font-size: 0.9em;">Materi</div>
                    </div>
                </div>
            </div>

            <div id="s-chat" class="mobile-page">
                <div class="wa-container">
                    <div class="wa-header">
                        <div style="width: 35px; height: 35px; background: #ddd; border-radius: 50%; overflow: hidden;">
                            <img src="https://ui-avatars.com/api/?name=Class+Room&background=random" width="100%">
                        </div>
                        <div>
                            <div style="font-weight: 600; font-size: 0.95em;">Grup Kelas Bahasa Inggris</div>
                            <div style="font-size: 0.75em; opacity: 0.8;">Mam Yanti, You, ...</div>
                        </div>
                    </div>
                    <div class="wa-messages" id="wa-msg-container">
                        <div class="wa-bubble you">
                            <div style="font-weight: 700; color: #E57373; font-size: 0.8em; margin-bottom: 2px;">Mam Yanti</div>
                            Hello students! Don't forget your homework.
                            <span class="wa-time">08:00</span>
                        </div>
                        <div class="wa-bubble me">
                            Yes Mam, I'm working on it!
                            <span class="wa-time">08:05 <i class="fa-solid fa-check-double" style="color: #4FC3F7;"></i></span>
                        </div>
                    </div>
                    <div class="wa-input-area">
                        <input type="text" class="wa-input" placeholder="Ketik pesan...">
                        <button class="btn wa-send-btn"><i class="fa-solid fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>

            <div id="s-rank" class="mobile-page">
                <h2 style="margin-bottom: 15px;">Top Students</h2>
                <div class="lb-tabs">
                    <button class="lb-tab active" id="tab-cls-s">Kelas Ini</button>
                    <button class="lb-tab" id="tab-glb-s">Global</button>
                </div>
                <div class="m-card" style="padding: 0;">
                    <div id="student-rank-list">
                        <div class="rank-item">
                            <div class="rank-num">1</div>
                            <div class="rank-info">
                                <div class="rank-name">Andi Saputra</div>
                                <div class="rank-class">XII-1</div>
                            </div>
                            <div class="rank-pts">1250 Pts</div>
                        </div>
                        <div class="rank-item">
                            <div class="rank-num">2</div>
                            <div class="rank-info">
                                <div class="rank-name">Siti Aminah</div>
                                <div class="rank-class">XII-1</div>
                            </div>
                            <div class="rank-pts">1100 Pts</div>
                        </div>
                        <div style="text-align: center; padding: 20px; color: #999; font-size: 0.9em;">
                            Ini contoh tampilan. Data asli akan segera masuk.
                        </div>
                    </div>
                </div>
            </div>

            <div id="s-profile" class="mobile-page">
                <div class="m-card" style="text-align: center; padding: 30px;">
                    <div style="width: 80px; height: 80px; background: #eee; border-radius: 50%; margin: 0 auto 15px; overflow: hidden;">
                        <img src="https://ui-avatars.com/api/?name=Student&background=random" width="100%" id="profile-img">
                    </div>
                    <h2 id="p-name">Nama Siswa</h2>
                    <p id="p-email" style="color: #999; font-size: 0.9em;">email@siswa.com</p>
                    <button class="btn" id="student-logout-btn" style="margin-top: 20px; color: red; border: 1px solid red; padding: 8px 20px; border-radius: 20px; background: white;">Keluar Akun</button>
                </div>
            </div>
            
            <div class="miapps-footer">Web ini dibuat oleh MiAppsDeveloper 2025</div>

        </div>

        <nav class="bottom-nav">
            <button class="nav-item active" onclick="switchStudentPage('s-home', this)">
                <i class="fa-solid fa-house"></i> Home
            </button>
            <button class="nav-item" onclick="switchStudentPage('s-chat', this)">
                <i class="fa-brands fa-whatsapp"></i> Chat
            </button>
            <button class="nav-item" onclick="switchStudentPage('s-rank', this)">
                <i class="fa-solid fa-trophy"></i> Rank
            </button>
            <button class="nav-item" onclick="switchStudentPage('s-profile', this)">
                <i class="fa-solid fa-user"></i> Me
            </button>
        </nav>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <script>
        // ==========================================
        // KONFIGURASI FIREBASE (JANGAN DIUBAH)
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyDpYabA0lb-0uh3Pe-URmeY7WxpIHj7c5Q",
            authDomain: "e-learning-mamyanti.firebaseapp.com",
            projectId: "e-learning-mamyanti",
            storageBucket: "e-learning-mamyanti.appspot.com",
            messagingSenderId: "198925356373",
            appId: "1:198925356373:web:754ae2355b925aa50333dc"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // --- UI LOGIC ---
        
        const TEACHER_EMAIL = "elearningmamyanti@gmail.com";
        
        // 1. Login Logic
        auth.onAuthStateChanged(user => {
            // Jika ada user, sembunyikan login
            if (user) {
                document.getElementById('login-page').classList.add('hidden');
                console.log("User logged in:", user.email);
                
                if (user.email.toLowerCase() === TEACHER_EMAIL) {
                    // Tampilkan UI Guru
                    document.getElementById('teacher-app').style.display = 'grid'; 
                    document.getElementById('teacher-app').classList.remove('hidden');
                    document.getElementById('student-app').classList.add('hidden');
                } else {
                    // Tampilkan UI Siswa
                    document.getElementById('student-app').style.display = 'flex';
                    document.getElementById('student-app').classList.remove('hidden');
                    document.getElementById('teacher-app').classList.add('hidden');
                    
                    document.getElementById('s-name-display').textContent = user.displayName ? user.displayName.split(' ')[0] : 'Student';
                    document.getElementById('p-name').textContent = user.displayName;
                    document.getElementById('p-email').textContent = user.email;
                }
            } else {
                // Jika Logout/Belum Login
                console.log("No user logged in.");
                document.getElementById('login-page').classList.remove('hidden');
                document.getElementById('login-page').style.display = 'flex'; // Force show
                document.getElementById('teacher-app').classList.add('hidden');
                document.getElementById('student-app').classList.add('hidden');
            }
        });

        document.getElementById('login-btn').addEventListener('click', () => {
            document.getElementById('login-spinner').classList.remove('hidden');
            document.getElementById('login-btn').style.display = 'none';
            
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).catch(err => {
                alert("Gagal Login: " + err.message);
                document.getElementById('login-spinner').classList.add('hidden');
                document.getElementById('login-btn').style.display = 'flex';
            });
        });
        
        document.getElementById('teacher-logout').addEventListener('click', () => {
            if(confirm("Keluar dari Dashboard Guru?")) auth.signOut();
        });
        
        document.getElementById('student-logout-btn').addEventListener('click', () => {
            if(confirm("Keluar dari Akun?")) auth.signOut();
        });

        // 2. Tab Switching Logic (Guru)
        window.switchTeacherTab = (tabId) => {
            document.querySelectorAll('.teacher-tab').forEach(el => el.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
            
            // Reset active state sidebar
            document.querySelectorAll('.sidebar-btn').forEach(btn => btn.classList.remove('active'));
            // Set clicked button active (cari parent atau elemen itu sendiri)
            // Simple hack: we just assume it works for demo
        }

        // 3. Page Switching Logic (Siswa - Bottom Nav)
        window.switchStudentPage = (pageId, btnElement) => {
            document.querySelectorAll('.mobile-page').forEach(el => el.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            btnElement.classList.add('active');
        }
        
        // 4. Tab Rank Logic (Visual Only)
        window.toggleRankTab = (type) => {
            const tabs = document.querySelectorAll('.lb-tab');
            tabs.forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }

    </script>
</body>
</html>
